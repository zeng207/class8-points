<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…­å¹´å…«ç­è¯¾å ‚ç§¯åˆ†ä¹å›­</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Microsoft YaHei', sans-serif; background-color: #f0f8ff; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: #4a90e2; font-size: 2.5em; margin-bottom: 10px; }
        .header p { color: #666; font-size: 1.2em; }
        .class-photo { width: 100%; max-height: 400px; object-fit: cover; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin: 20px 0; }
        .entry-buttons { text-align: center; margin: 30px 0; }
        .entry-buttons button { background-color: #4a90e2; color: white; border: none; padding: 15px 30px; font-size: 1.2em; border-radius: 10px; cursor: pointer; margin: 0 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: background-color 0.3s; }
        .entry-buttons button:hover { background-color: #357abd; }
        .teacher-view, .student-view { display: none; }
        .week-selector { text-align: center; margin: 20px 0; font-size: 1.2em; }
        .week-selector select { padding: 10px; font-size: 1em; border-radius: 5px; border: 1px solid #ccc; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; background-color: white; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-radius: 10px; overflow: hidden; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: center; }
        th { background-color: #4a90e2; color: white; font-weight: bold; }
        .name-cell { text-align: left; padding-left: 20px; font-weight: bold; }
        .daily-score { font-size: 0.8em; color: #666; margin-top: 2px; display: flex; justify-content: space-around; }
        .daily-score div { width: 20%; text-align: center; }
        .total { font-weight: bold; color: #4a90e2; }
        .score-input { width: 60px; padding: 5px; margin: 0 auto; border: 2px solid #ddd; border-radius: 5px; text-align: center; font-size: 1em; }
        .score-input:focus { border-color: #4a90e2; outline: none; }
        .actions { text-align: center; margin: 20px 0; }
        .actions button { background-color: #f0ad4e; color: white; border: none; padding: 10px 20px; margin: 0 10px; border-radius: 5px; cursor: pointer; font-size: 1em; }
        .back-btn { display: block; width: 120px; margin: 20px auto; background-color: #6c757d; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; text-align: center; }
        .student-form, .rankings { text-align: center; margin: 50px 0; }
        .student-form input { padding: 10px; width: 200px; font-size: 1em; border: 1px solid #ccc; border-radius: 5px; margin-right: 10px; }
        .student-form button { background-color: #4a90e2; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
        .student-result { background-color: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); max-width: 800px; margin: 30px auto; }
        .student-result h2, .rankings h2 { color: #4a90e2; margin-bottom: 20px; text-align: center; }
        .result-item, .rank-item { margin: 15px 0; font-size: 1.2em; }
        .rank-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px dashed #eee; }
        .rank-item:first-child { background-color: #fff4e6; }
        .rank-item:nth-child(2) { background-color: #f0f8ff; }
        .rank-item:nth-child(3) { background-color: #fff8e1; }
        .rank-icon { font-size: 1.5em; }
        .progress-star { background-color: #ffeb3b; padding: 2px 8px; border-radius: 10px; font-weight: bold; }
        .backup-tools { text-align: center; margin: 20px 0; font-size: 1.1em; }
        .backup-tools button { background-color: #5cb85c; color: white; border: none; padding: 10px 20px; margin: 0 10px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>å…­å¹´å…«ç­è¯¾å ‚ç§¯åˆ†ä¹å›­</h1>
            <p>è®°å½•æˆé•¿ï¼Œå¿«ä¹å­¦ä¹ </p>
        </div>

        <img src="class.jpg" alt="å…­å¹´å…«ç­å…¨å®¶ç¦" class="class-photo">
        
        <div class="entry-buttons" id="homeButtons">
            <button onclick="loginAsTeacher()">æˆ‘æ˜¯è€å¸ˆ ğŸ‘©â€ğŸ«</button>
            <button onclick="showStudentView()">æˆ‘æ˜¯å­¦ç”Ÿ ğŸ§’</button>
        </div>

        <!-- è€å¸ˆè§†å›¾ -->
        <div id="teacherView" class="teacher-view">
            <h2 style="text-align:center;">å…­ï¼ˆ8ï¼‰ç­è¯­æ–‡è¯¾å ‚ç§¯åˆ†è¡¨</h2>

            <!-- æ–°å¢ï¼šæ•°æ®å¤‡ä»½å·¥å…· -->
            <div class="backup-tools">
                <button onclick="exportData()">ğŸ’¾ å¯¼å‡ºæ•°æ®ï¼ˆä¿å­˜åˆ°ç”µè„‘ï¼‰</button>
                <button onclick="importData()">ğŸ“‚ å¯¼å…¥æ•°æ®ï¼ˆæ¢å¤å¤‡ä»½ï¼‰</button>
            </div>

            <div class="week-selector">
                <label for="weekSelect">ç¬¬ </label>
                <select id="weekSelect">
                    <option>1</option><option>2</option><option>3</option><option>4</option>
                    <option>5</option><option>6</option><option>7</option><option>8</option>
                    <option>9</option><option>10</option>
                </select>
                <label for="weekSelect"> å‘¨</label>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>åºå·</th><th>å§“å</th><th>å‘¨ä¸€</th><th>å‘¨äºŒ</th><th>å‘¨ä¸‰</th><th>å‘¨å››</th><th>å‘¨äº”</th><th>æ€»åˆ†</th>
                        <th>åºå·</th><th>å§“å</th><th>å‘¨ä¸€</th><th>å‘¨äºŒ</th><th>å‘¨ä¸‰</th><th>å‘¨å››</th><th>å‘¨äº”</th><th>æ€»åˆ†</th>
                    </tr>
                </thead>
                <tbody id="teacherTableBody">
                    <!-- ç”±JSåŠ¨æ€ç”Ÿæˆ -->
                </tbody>
            </table>

            <div class="actions">
                <button onclick="saveAndExit()">ä¿å­˜å¹¶é€€å‡º</button>
                <button onclick="clearWeekData()">æ¸…ç©ºæœ¬å‘¨æ•°æ®</button>
                <button onclick="goBackToHome()">è¿”å›é¦–é¡µ</button>
                <button onclick="logout()" style="background-color: #d9534f;">é€€å‡ºç™»å½•</button>
                <button onclick="openChangePassword()" style="background-color: #5cb85c;">ä¿®æ”¹å¯†ç </button>
            </div>
            <p style="text-align:center; color:#999; font-size:0.9em; margin-top:10px;">
                ğŸ” æ¸©é¦¨æç¤ºï¼šè¯·è€å¸ˆç¦»å¼€å‰ç‚¹å‡»ã€é€€å‡ºç™»å½•ã€‘ä»¥ä¿æŠ¤æ•°æ®å®‰å…¨ã€‚
            </p>
        </div>

        <!-- å­¦ç”ŸæŸ¥çœ‹é¡µ -->
        <div id="studentView" class="student-view">
            <div class="student-form">
                <h2>æŸ¥çœ‹æˆ‘çš„ç§¯åˆ†</h2>
                <input type="text" id="studentName" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å">
                <button onclick="checkStudent()">æŸ¥è¯¢</button>
            </div>

            <div class="student-result" id="studentResult" style="display:none;">
                <h2>æ¬¢è¿ï¼Œ<span id="resultName"></span>ï¼ğŸŒŸ</h2>
                <div class="result-item">æ‚¨æœ¬å‘¨çš„ç§¯åˆ†æ˜¯ï¼š<span id="resultScore">0</span> åˆ†</div>
                <div class="result-item">æ‚¨åœ¨ç­çº§ä¸­çš„æ’åæ˜¯ç¬¬ <span id="resultRank">1</span> å</div>
                <div class="result-item" id="resultReward"></div>
                <div class="result-item"><span id="resultProgress"></span></div>

                <div class="rankings">
                    <h2>ğŸŒŸ æœ¬å‘¨è¿›æ­¥ä¹‹æ˜Ÿ</h2>
                    <div id="progressList">
                        <!-- ç”±JSå¡«å…… -->
                    </div>
                </div>

                <div class="rankings">
                    <h2>ğŸ† æœ¬å‘¨ç§¯åˆ†å‰åå</h2>
                    <div id="top10List">
                        <!-- ç”±JSå¡«å…… -->
                    </div>
                </div>

                <button class="back-btn" onclick="goBackToHome()">è¿”å›é¦–é¡µ</button>
            </div>
        </div>
    </div>

    <script>
        // ================== ğŸ” å¯†ç ç®¡ç† ==================
        let ENCODED_PASSWORD = 'MTIzNDU2'; // '123456'

        // å…¨å±€å˜é‡
        let students = [];
        let isTeacherLoggedIn = false;

        // ================== å­¦ç”Ÿæ•°æ® ==================
        const initialStudents = [
            { id: 1, name: "å¢æ·³é›…", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 50 },
            { id: 2, name: "é»„ç­±æ™´", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 70 },
            { id: 3, name: "ææ©å¯", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 65 },
            { id: 4, name: "èµµå…ƒåœ†", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 60 },
            { id: 5, name: "å‘¨è¯—éœ–", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 55 },
            { id: 6, name: "æ—æ¢“çƒ", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 40 },
            { id: 7, name: "å­™æ™¨ç†™", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 30 },
            { id: 8, name: "é™ˆæ­£éœ–", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 50 },
            { id: 9, name: "å¶å±•æ–°", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 45 },
            { id: 10, name: "å­™æ³½é’°", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 40 },
            { id: 11, name: "æ±¤  åª›", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 50 },
            { id: 12, name: "é™ˆå¯æ­†", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 35 },
            { id: 13, name: "ç‹åœ£æ¼ª", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 48 },
            { id: 14, name: "é™ˆæ¢“å®", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 55 },
            { id: 15, name: "æ—é›¨å¢•", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 50 },
            { id: 16, name: "é½ä¿®è¿œ", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 58 },
            { id: 17, name: "ç‹æ›¾æ‡¿", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 42 },
            { id: 18, name: "è¿æŸè¡¡", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 45 },
            { id: 19, name: "é«˜  å¸Œ", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 48 },
            { id: 20, name: "éƒ­å’Œç››", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 40 },
            { id: 21, name: "æœ±é“­è½©", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 38 },
            { id: 22, name: "æ–½å¦æ˜•", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 52 },
            { id: 23, name: "é™ˆçºªå¼¥", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 45 },
            { id: 24, name: "ç‹é–è±", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 50 },
            { id: 25, name: "è®¸å©‰ç³", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 45 },
            { id: 26, name: "é¾šå“ç®", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 50 },
            { id: 27, name: "ç‹èƒ¤ç¥¥", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 55 },
            { id: 28, name: "å´é”¦éœ–", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 48 },
            { id: 29, name: "ä»»æ™ºç¿”", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 40 },
            { id: 30, name: "å¼ è«ç„¶", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 50 },
            { id: 31, name: "æ¬§é˜³é‘«æ€¡", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 55 },
            { id: 32, name: "å¼ é›…é¦¨", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 58 },
            { id: 33, name: "æ›¾çªæ·‘", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 50 },
            { id: 34, name: "å­™å¯é¦¨", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 45 },
            { id: 35, name: "å¢æ¬£æ€¡", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 40 },
            { id: 36, name: "ç‹å­ç¿", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 50 },
            { id: 37, name: "è‚–åšæ’", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 55 },
            { id: 38, name: "æ´ªå­é’¦", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 48 },
            { id: 39, name: "é»„æ¬æ¬£", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 52 },
            { id: 40, name: "èƒ¡ä½³ä¿Š", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 35 },
            { id: 41, name: "å­™æ°é“­", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 40 },
            { id: 42, name: "å´æ³½æ¥·", scores: { mon: 0, tue: 0, wed: 0, thu: 0, fri: 0 }, total: 0, lastWeek: 30 }
        ];

        // ================== é¡µé¢åŠ è½½ ==================
        window.onload = function() {
            const savedPassword = localStorage.getItem('class8Password');
            if (savedPassword) {
                ENCODED_PASSWORD = savedPassword;
            }

            const saved = localStorage.getItem('class8Students');
            if (saved) {
                try {
                    students = JSON.parse(saved);
                } catch (e) {
                    console.error("æ•°æ®è§£æå¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®");
                    students = JSON.parse(JSON.stringify(initialStudents));
                }
            } else {
                students = JSON.parse(JSON.stringify(initialStudents));
            }

            isTeacherLoggedIn = false;
            generateTeacherTable();
            updateAllTotals();
        };

        function getRealPassword() {
            try {
                return atob(ENCODED_PASSWORD);
            } catch (e) {
                alert('å¯†ç è§£ç å¤±è´¥ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ã€‚');
                return '';
            }
        }

        function setNewPassword(newPwd) {
            ENCODED_PASSWORD = btoa(newPwd);
            localStorage.setItem('class8Password', ENCODED_PASSWORD);
        }

        // ================== æ•°æ®æ“ä½œ ==================
        function saveData() {
            localStorage.setItem('class8Students', JSON.stringify(students));
        }

        function saveAndExit() {
            saveData();
            alert('âœ… æ•°æ®å·²ä¿å­˜ï¼');
            goBackToHome();
        }

        function clearWeekData() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæœ¬å‘¨æ‰€æœ‰æ•°æ®å—ï¼Ÿ')) {
                students.forEach(s => {
                    s.scores.mon = 0;
                    s.scores.tue = 0;
                    s.scores.wed = 0;
                    s.scores.thu = 0;
                    s.scores.fri = 0;
                    s.total = 0;
                });
                updateAllTotals();
                saveData();
            }
        }

        // ================== å¯¼å‡º/å¯¼å…¥ ==================
        function exportData() {
            const dataStr = JSON.stringify(students, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'å…­å¹´å…«ç­ç§¯åˆ†æ•°æ®_' + new Date().toLocaleDateString() + '.json';
            a.click();
            URL.revokeObjectURL(url);
            alert('âœ… æ•°æ®å·²å¯¼å‡ºï¼Œè¯·ä¿å­˜åˆ°ç”µè„‘');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = event => {
                    try {
                        students = JSON.parse(event.target.result);
                        updateAllTotals();
                        generateTeacherTable();
                        saveData();
                        alert('âœ… æ•°æ®å¯¼å…¥æˆåŠŸï¼');
                    } catch (err) {
                        alert('âŒ æ–‡ä»¶æ ¼å¼é”™è¯¯');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // ================== ç™»å½• ==================
        function loginAsTeacher() {
            const pwd = prompt('è¯·è¾“å…¥è€å¸ˆå¯†ç  ğŸ”');
            if (pwd === null) return;
            if (pwd === getRealPassword()) {
                isTeacherLoggedIn = true;
                sessionStorage.setItem('teacherLoggedIn', 'true');
                showTeacherView();
            } else {
                alert('å¯†ç é”™è¯¯ï¼');
            }
        }

        function showTeacherView() {
            const loggedIn = sessionStorage.getItem('teacherLoggedIn') === 'true';
            if (!loggedIn) { loginAsTeacher(); return; }
            document.getElementById('homeButtons').style.display = 'none';
            document.querySelector('.header').style.display = 'none';
            document.querySelector('.class-photo').style.display = 'none';
            document.getElementById('teacherView').style.display = 'block';
        }

        function showStudentView() {
            document.getElementById('homeButtons').style.display = 'none';
            document.querySelector('.header').style.display = 'none';
            document.querySelector('.class-photo').style.display = 'none';
            document.getElementById('studentView').style.display = 'block';
        }

        function goBackToHome() {
            document.getElementById('teacherView').style.display = 'none';
            document.getElementById('studentView').style.display = 'none';
            document.getElementById('homeButtons').style.display = 'block';
            document.querySelector('.header').style.display = 'block';
            document.querySelector('.class-photo').style.display = 'block';
        }

        function logout() {
            sessionStorage.removeItem('teacherLoggedIn');
            isTeacherLoggedIn = false;
            alert('å·²å®‰å…¨é€€å‡ºç™»å½•');
            goBackToHome();
        }

        function openChangePassword() {
            const oldPwd = prompt('è¯·è¾“å…¥å½“å‰å¯†ç ï¼š');
            if (oldPwd !== getRealPassword()) { alert('åŸå¯†ç é”™è¯¯ï¼'); return; }
            const newPwd = prompt('è¯·è¾“å…¥æ–°å¯†ç ï¼š');
            if (!newPwd || newPwd.trim() === '') { alert('å¯†ç ä¸èƒ½ä¸ºç©ºï¼'); return; }
            const confirmPwd = prompt('è¯·å†æ¬¡è¾“å…¥ï¼š');
            if (newPwd !== confirmPwd) { alert('ä¸¤æ¬¡è¾“å…¥ä¸ä¸€è‡´ï¼'); return; }
            setNewPassword(newPwd);
            alert('âœ… å¯†ç å·²æ›´æ–°ï¼');
        }

        // ================== è¡¨æ ¼ ==================
        function generateTeacherTable() {
            const tbody = document.getElementById('teacherTableBody');
            let html = '';
            for (let i = 0; i < 21; i++) {
                const left = students[i];
                const right = students[i + 21] || { id: '', name: '', scores: { mon:0,tue:0,wed:0,thu:0,fri:0 }, total: 0 };
                html += `
                <tr>
                    <td>${left.id}</td>
                    <td class="name-cell">${left.name}
                        <div class="daily-score">
                            <div>å‘¨ä¸€:${left.scores.mon}</div>
                            <div>å‘¨äºŒ:${left.scores.tue}</div>
                            <div>å‘¨ä¸‰:${left.scores.wed}</div>
                            <div>å‘¨å››:${left.scores.thu}</div>
                            <div>å‘¨äº”:${left.scores.fri}</div>
                        </div>
                    </td>
                    <td><input type="number" class="score-input" id="input-${left.id}-mon" placeholder="0" onkeydown="if(event.key==='Enter'){updateScore(${left.id},'mon',parseInt(this.value)||0);this.value='';}"></td>
                    <td><input type="number" class="score-input" id="input-${left.id}-tue" placeholder="0" onkeydown="if(event.key==='Enter'){updateScore(${left.id},'tue',parseInt(this.value)||0);this.value='';}"></td>
                    <td><input type="number" class="score-input" id="input-${left.id}-wed" placeholder="0" onkeydown="if(event.key==='Enter'){updateScore(${left.id},'wed',parseInt(this.value)||0);this.value='';}"></td>
                    <td><input type="number" class="score-input" id="input-${left.id}-thu" placeholder="0" onkeydown="if(event.key==='Enter'){updateScore(${left.id},'thu',parseInt(this.value)||0);this.value='';}"></td>
                    <td><input type="number" class="score-input" id="input-${left.id}-fri" placeholder="0" onkeydown="if(event.key==='Enter'){updateScore(${left.id},'fri',parseInt(this.value)||0);this.value='';}"></td>
                    <td class="total" id="total-${left.id}">${left.total}</td>
                    
                    <td>${right.id}</td>
                    <td class="name-cell">${right.name}
                        <div class="daily-score">
                            <div>å‘¨ä¸€:${right.scores.mon}</div>
                            <div>å‘¨äºŒ:${right.scores.tue}</div>
                            <div>å‘¨ä¸‰:${right.scores.wed}</div>
                            <div>å‘¨å››:${right.scores.thu}</div>
                            <div>å‘¨äº”:${right.scores.fri}</div>
                        </div>
                    </td>
                    <td><input type="number" class="score-input" id="input-${right.id}-mon" placeholder="0" onkeydown="if(event.key==='Enter'){updateScore(${right.id},'mon',parseInt(this.value)||0);this.value='';}"></td>
                    <td><input type="number" class="score-input" id="input-${right.id}-tue" placeholder="0" onkeydown="if(event.key==='Enter'){updateScore(${right.id},'tue',parseInt(this.value)||0);this.value='';}"></td>
                    <td><input type="number" class="score-input" id="input-${right.id}-wed" placeholder="0" onkeydown="if(event.key==='Enter'){updateScore(${right.id},'wed',parseInt(this.value)||0);this.value='';}"></td>
                    <td><input type="number" class="score-input" id="input-${right.id}-thu" placeholder="0" onkeydown="if(event.key==='Enter'){updateScore(${right.id},'thu',parseInt(this.value)||0);this.value='';}"></td>
                    <td><input type="number" class="score-input" id="input-${right.id}-fri" placeholder="0" onkeydown="if(event.key==='Enter'){updateScore(${right.id},'fri',parseInt(this.value)||0);this.value='';}"></td>
                    <td class="total" id="total-${right.id}">${right.total}</td>
                </tr>`;
            }
            tbody.innerHTML = html;
        }

        function updateScore(id, day, points) {
            if (points === 0) return;
            const student = students.find(s => s.id === id);
            if (student) {
                student.scores[day] += points;
                student.total = Object.values(student.scores).reduce((a,b)=>a+b, 0);
                document.getElementById(`total-${id}`).textContent = student.total;
                const row = document.querySelector(`#teacherTableBody tr:nth-child(${Math.ceil(id/2)})`);
                if (row) {
                    const days = ['mon','tue','wed','thu','fri'];
                    const dayNames = ['å‘¨ä¸€','å‘¨äºŒ','å‘¨ä¸‰','å‘¨å››','å‘¨äº”'];
                    const idx = days.indexOf(day);
                    const divs = row.querySelectorAll('.daily-score div');
                    if (idx >= 0 && divs[idx]) {
                        divs[idx].textContent = `${dayNames[idx]}:${student.scores[day]}`;
                    }
                }
                // âœ… æ¯æ¬¡æ‰“åˆ†éƒ½ä¿å­˜
                localStorage.setItem('class8Students', JSON.stringify(students));
            }
        }

        function updateAllTotals() {
            students.forEach(s => {
                s.total = Object.values(s.scores).reduce((a,b)=>a+b, 0);
                const elem = document.getElementById(`total-${s.id}`);
                if (elem) elem.textContent = s.total;
            });
        }

        function checkStudent() {
            const name = document.getElementById('studentName').value.trim();
            if (!Array.isArray(students) || students.length === 0) {
                students = JSON.parse(JSON.stringify(initialStudents));
            }
            const student = students.find(s => s.name === name);
            if (!student) {
                alert('æœªæ‰¾åˆ°è¯¥å­¦ç”Ÿï¼Œè¯·æ£€æŸ¥å§“åæ˜¯å¦æ­£ç¡®ï¼ˆæ³¨æ„ç©ºæ ¼ï¼‰');
                return;
            }
            document.getElementById('resultName').textContent = student.name;
            document.getElementById('resultScore').textContent = student.total;
            const sorted = [...students].sort((a,b)=>b.total-a.total);
            document.getElementById('resultRank').textContent = sorted.findIndex(s=>s.id===student.id)+1;
            document.getElementById('resultReward').innerHTML = 
                student.total >= 30 ? `ğŸ‰ å¯æŠµæ‰£ <strong>${Math.floor(student.total/30)} é¡¹</strong> ä½œä¸šï¼` : `ğŸ’ª ç»§ç»­åŠ æ²¹ï¼`;
            const progress = student.total - student.lastWeek;
            document.getElementById('resultProgress').innerHTML = progress > 0 
                ? `ğŸ“ˆ è¿›æ­¥ <strong>+${progress}åˆ†</strong>ï¼` : progress < 0 
                ? `ğŸ“‰ é€€æ­¥ <strong>${-progress}åˆ†</strong>` : `ğŸ“Š ä¿æŒç¨³å®š`;
            updateRankings();
            document.getElementById('studentResult').style.display = 'block';
        }

        function updateRankings() {
            const top10 = [...students].sort((a,b)=>b.total-a.total).slice(0,10);
            document.getElementById('top10List').innerHTML = top10.map((s,i)=>{
                const medal = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'][i] || '';
                return `<div class="rank-item"><span class="rank-icon">${medal}</span><span>${s.name}</span><span>${s.total}åˆ†</span></div>`;
            }).join('');
            const progressList = students.map(s=>({name:s.name, p:s.total-s.lastWeek}))
                .filter(s=>s.p>0).sort((a,b)=>b.p-a.p).slice(0,3);
            document.getElementById('progressList').innerHTML = progressList.length > 0
                ? progressList.map(s=>`<div class="rank-item"><span class="progress-star">â­</span><span>${s.name}</span><span>+${s.p}åˆ†</span></div>`).join('')
                : '<div class="rank-item">æœ¬å‘¨æš‚æ— æ˜¾è‘—è¿›æ­¥çš„åŒå­¦ï¼Œå¤§å®¶åŠ æ²¹ï¼</div>';
        }
    </script>
</body>
</html>
